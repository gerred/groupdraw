var util={};util.getMousePos=function a(a,b){var c=a,d=0,e=0;while(c&&c.tagName!="BODY")d+=c.offsetTop,e+=c.offsetLeft,c=c.offsetParent;var f=b.clientX-e+window.pageXOffset,g=b.clientY-d+window.pageYOffset;return{x:f,y:g}},jQuery(function(a){function k(a){mouse=util.getMousePos(b,a),c.lineTo(mouse.x,mouse.y),c.stroke(),j.push([mouse.x,mouse.y])}var b=document.getElementById("canvas"),c=b.getContext("2d"),d=c.getImageData(0,0,b.width,b.height),e=d.data,f,g=10,h=100,i=io.connect(),j=[];i.on("draw",function(a){c.save(),c.beginPath(),initialPoint=a.shift(),c.moveTo(initialPoint[0],initialPoint[1]);for(var b=0;b<a.length;b++)c.lineTo(a[b][0],a[b][1]);c.stroke(),c.closePath(),c.restore()}),i.on("imageload",function(b){image=new Image,image.src=b.url,image.onload=function(){a("#canvas").attr("width",b.width),a("#canvas").attr("height",b.height),c.save(),c.drawImage(image,0,0,image.width,image.height,0,0,b.width,b.height),c.restore()}}),b.addEventListener("mousedown",function(a){c.beginPath(),position=util.getMousePos(b,a),c.moveTo(position.x,position.y),j.push([position.x,position.y]),b.addEventListener("mousemove",k,!1)},!1),b.addEventListener("mouseup",function(){c.closePath(),i.emit("draw",j),j=[],b.removeEventListener("mousemove",k,!1)},!1),a("form").on("submit",function(b){b.preventDefault(),image=new Image,image.src=a("#name").val(),image.onload=function(){i.emit("imageload",{width:image.width*.75,height:image.height*.75,url:image.src}),a("#canvas").attr("width",image.width*.75),a("#canvas").attr("height",image.height*.75),c.save(),c.drawImage(image,0,0,image.width,image.height,0,0,image.width*.75,image.height*.75),c.restore()}})})